---
title: "epmfd package"
output: github_document
author: "Hasan Bulut"
---

# Why epmfd?

***`epmfd`*** (Educational Person-Misfit Detection) wraps a practical workflow to

1.  Load polytomous item responses.

2.  Scale items via MIRT (graded response) or non-parametric Mokken, dropping weak items automatically.

3.  Compute three robust person-fit statistics (lpz, Gp, U3p).

4.  Flag and remove mis-fitting persons in one line.

5.  Visualise each step and export clean data for further modelling.

Everything works with three commands: ***`load_epmfd() → scale_epmfd() → misfit_epmfd()`*** – and no manual thresholds unless you want to tweak them.

# How to install the package?

```{r}
# development HEAD
remotes::install_github("hsnbulut/epmfd")
```

# Quick-start example

```{r}
library(epmfd)
library(mirt)
library(mokken)

raw    <- load_epmfd(sampledata)
scaled <- scale_epmfd(raw, method = "auto")
misfit <- misfit_epmfd(scaled)
clean  <- clean_epmfd(misfit, criterion = "union")

## 3. inspect
print(misfit)
plot(scaled)
plot(misfit)
plot(clean)
plot_misfit(misfit, stats = c("Gnp","U3p","lpz"),
            threeD = TRUE, any = TRUE, label_ids = TRUE)

## 4. export
export_epmfd(clean, dir = "demo_out", 
             prefix = "study1", 
             format = "sav")

```

---
demo_out/
  study1_clean.csv    # cleaned item matrix (190 × remaining items)
  study1_misfit.csv   # person × statistic flags
  study1.rds          # full epmfd_clean object
---

# Item Selection: Customising the Thresholds

By default, scale_epmfd() automatically removes weak items based on the selected method:

-   If method = "mirt" (graded response model), items with discrimination parameter a \< 0.5 are removed.

-   If method = "mokken" (non-parametric scaling), items with scalability H_i \< 0.3 are removed.

You can customise these thresholds using the arguments a_thr and H_thr:

```{r}
library(epmfd)
library(mirt)
library(mokken)
scale_epmfd(raw, method = "mirt", a_thr = 0.6)         # for MIRT
scale_epmfd(raw, method = "mokken", H_thr = 0.35)      # for Mokken
```

To keep all items, simply set the threshold to zero:

```{r}
library(epmfd)
library(mirt)
library(mokken)
scale_epmfd(raw, method = "mirt", a_thr = 0)
scale_epmfd(raw, method = "mokken", H_thr = 0)
```

When method = "auto" (the default), the function uses:

-   "mokken" if the sample size is under 500,

-   "mirt" otherwise.

Even in auto mode, the thresholds can be overridden:

```{r}
library(epmfd)
library(mirt)
library(mokken)
scale_epmfd(raw, method = "auto", a_thr = 0.6, H_thr = 0.35)
```

**Note:** An item may be removed in `"mirt"` mode but retained in `"mokken"` mode, or vice versa, because the selection criteria differ between methods.

# Function Map

| Stage      | Function                  | Key options                                    |
|------------|---------------------------|------------------------------------------------|
| **Load**   | `load_epmfd()`            | `id_col`, `likert_levels` (auto detected)      |
| **Scale**  | `scale_epmfd()`           | `method`, `a_thr`, `H_thr`                     |
| **Misfit** | `misfit_epmfd()`          | `stats`, `cut.off`                             |
| **Clean**  | `clean_epmfd()`           | `criterion = "union"` / `"intersection"`       |
| **Plot**   | `plot()`, `plot_misfit()` | 2D/3D diagnostics                              |
| **Export** | `export_epmfd()`          | `dir`, `prefix`, `format = "csv"/"xlsx"/"sav"` |

# License

GPL-3 © 2025 Hasan Bulut & Asiye Şengül Avşar
