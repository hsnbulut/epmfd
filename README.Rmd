---
title: "epmfd – Robust Person-Misfit Detection for Polytomous IRT Data"
output: github_document
---

<!-- badges: start -->

<!-- badges: end -->

\`\`\`{r setup, include = FALSE} knitr::opts_chunk\$set( collapse = TRUE, comment = "#\>" )

# Why epmfd?

***`epmfd`*** (Educational Person-Misfit Detection) wraps a practical workflow to

1.  Load polytomous item responses.

2.  Scale items via MIRT (graded response) or non-parametric Mokken, dropping weak items automatically.

3.  Compute three robust person-fit statistics (lpz, Gp, U3p).

4.  Flag and remove mis-fitting persons in one line.

5.  Visualise each step and export clean data for further modelling.

Everything works with three commands: ***`load_epmfd() → scale_epmfd() → misfit_epmfd()`*** – and no manual thresholds unless you want to tweak them.

# How to install the package?

```{r}
# development HEAD
remotes::install_github("hsnbulut/epmfd")
```

# Quick-start example

The chunk below simulates **200 persons × 12 Likert items** (including a deliberately weak item and 5 random-response persons) and walks through the complete workflow.

```{r}
library(epmfd)
library(mirt)       # only for data simulation

set.seed(42)

## --- 1. simulate data -------------------------------------------------
m  <- 12; K <- 5
a <- c(runif(m-1, .8, 1.2), .2)                 # last item weak
d <- matrix(sort(runif(m*(K-1), -1.5, 1.5)),
            m, K-1, byrow = TRUE)

normal <- simdata(a, d, itemtype = "graded",
                  Theta = matrix(rnorm(195)))
bad    <- matrix(sample(1:K, 5*m, TRUE), 5, m)
toy    <- as.data.frame(rbind(normal, bad))
names(toy) <- paste0("Item", 1:m)

## --- 2. epmfd pipeline -----------------------------------------------
raw    <- load_epmfd(toy)
scaled <- scale_epmfd(raw, method = "auto")         # weak item removed
misfit <- misfit_epmfd(scaled, alpha = .05)         # lpz, Gp, U3p
clean  <- clean_epmfd(misfit, criterion = "union")  # 5 persons removed

## --- 3. inspect -------------------------------------------------------
print(misfit)         # textual summary
plot(scaled)          # bar + quality histogram
plot(misfit)          # misfit bars
plot(clean)           # remaining vs removed
plot_misfit_scatter(misfit, x_stat = "U3p",
                    y_stat = "Gp",
                    z_stat = "lpz",
                    bubble = TRUE,
                    label_ids = TRUE)

## --- 4. export --------------------------------------------------------
export_epmfd(clean, dir = "demo_out", prefix = "study1", format = "csv")

```

Output files:

---
demo_out/
  study1_clean.csv    # cleaned item matrix (190 × remaining items)
  study1_misfit.csv   # person × statistic flags
  study1.rds          # full epmfd_clean object
---

## Function Map

| Stage      | Function                             | Key options                                                 |
|-----------|--------------------------|-----------------------------------|
| **Load**   | `load_epmfd()`                       | `id_col`, `K` (auto detected)                               |
| **Scale**  | `scale_epmfd()`                      | `method = "auto"` / `"mirt"` / `"mokken"`, `a_thr`, `H_thr` |
| **Misfit** | `misfit_epmfd()`                     | `alpha`, `stats = c("lpz","Gp","U3p")`                      |
| **Clean**  | `clean_epmfd()`                      | `criterion = "union"` / `"intersection"`                    |
| **Plot**   | `plot()` S3, `plot_misfit_scatter()` | —                                                           |
| **Export** | `export_epmfd()`                     | `dir`, `prefix`, \`format = "csv"                           |

## License

GPL-3 © 2025 Hasan Bulut & Asiye Şengül Avşar
